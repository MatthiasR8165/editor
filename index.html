<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>PET-ID Editor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- üîí Cache komplett deaktivieren -->
<meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<!-- üé® Theme -->
<meta name="theme-color" content="#d8b48a">

<!-- üêæ Icons -->
<link rel="shortcut icon" href="/assets/icons/favicon.ico?v=editor">
<link rel="icon" type="image/x-icon" href="/assets/icons/favicon.ico?v=editor">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32.png?v=editor">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16.png?v=editor">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-touch-icon.png?v=editor">

<style>
:root{
  --bg:#f6f6f6; --card:#fff; --accent:#d8b48a;
  --text:#2b2b2b; --muted:#777;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;
  background:var(--bg); color:var(--text);
}

/* LOCK */
.lock-wrapper{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:32px}
.lock{max-width:520px;width:100%;background:var(--card);padding:32px;border-radius:18px;box-shadow:0 6px 20px rgba(0,0,0,.08);text-align:center}
.lock input{width:100%;padding:14px;border-radius:12px;border:1px solid #ccc;font-size:16px;margin-bottom:16px}
.lock button{width:100%;padding:14px;border-radius:12px;border:none;background:var(--accent);font-weight:600}

/* EDITOR */
.editor{display:none;max-width:1400px;margin:0 auto;padding:32px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:32px}
@media(max-width:900px){.grid{grid-template-columns:1fr}}

.card{background:var(--card);border-radius:18px;box-shadow:0 4px 14px rgba(0,0,0,.06)}
.card-inner{padding:28px 32px}
h2{margin:0 0 12px}

label{
  display:block;
  max-width:540px;
  margin:18px auto 6px;
  font-size:14px;
  font-weight:600;
  color:#444;
}
input,textarea{
  width:100%;
  max-width:540px;
  margin:0 auto;
  display:block;
  padding:12px 14px;
  border-radius:12px;
  border:1px solid #ccc;
  font-size:15px;
}
textarea{min-height:70px;resize:vertical}
input[type=file]{padding:10px}

.actions{grid-column:1/-1}
.actions button{
  width:100%;
  padding:16px;
  border-radius:14px;
  border:none;
  font-size:16px;
  font-weight:600;
  margin-top:12px;
  cursor:pointer;
}
.download{background:#4caf50;color:#fff}

pre{
  background:#111;
  color:#0f0;
  padding:16px;
  border-radius:12px;
  font-size:13px;
  max-height:360px;
  overflow:auto;
  display:none;
}
</style>
</head>

<body>

<!-- üîê LOCK -->
<div class="lock-wrapper" id="lockWrapper">
  <div class="lock">
    <h2>üîê PET-ID Editor</h2>
    <input id="pin" placeholder="PIN" onkeydown="if(event.key==='Enter'){unlock()}">
    <button type="button" onclick="unlock()">Entsperren</button>
  </div>
</div>

<!-- ‚úèÔ∏è EDITOR -->
<div class="editor" id="editor">
<div class="grid">

<!-- META -->
<div class="card"><div class="card-inner">
<h2>Meta</h2>
<label>Name</label><input id="name">
<label>PET-ID</label><input id="pet_id">
<label>Untertitel</label><input id="subtitle">
<label>Bild</label><input type="file" id="image">
</div></div>

<!-- TIER -->
<div class="card"><div class="card-inner">
<h2>Tier</h2>
<label>Tierart</label><input id="species">
<label>Geschlecht</label><input id="gender">
<label>Geburtsdatum</label><input id="birthdate">
<label>Farbe</label><input id="color">
<label>Rasse</label><input id="breed">
<label>Kastriert</label><input id="castrated">
<label>Freig√§nger</label><input id="outdoor">
<label>Gechippt</label><input id="chipped">
<label>Geimpft</label><input id="vaccinated">
<label>Mikrochip</label><input id="microchip">
<label>Hinweis</label><textarea id="note"></textarea>
</div></div>

<!-- BESITZER 1 -->
<div class="card"><div class="card-inner">
<h2>Besitzer 1</h2>
<label>Name</label><input id="o1_name">
<label>Telefon</label><input id="o1_phone">
<label>E-Mail</label><input id="o1_email">
</div></div>

<!-- BESITZER 2 -->
<div class="card"><div class="card-inner">
<h2>Besitzer 2</h2>
<label>Name</label><input id="o2_name">
<label>Telefon</label><input id="o2_phone">
<label>E-Mail</label><input id="o2_email">
</div></div>

<!-- TIERARZT -->
<div class="card"><div class="card-inner">
<h2>Tierarzt</h2>
<label>Praxis</label><input id="vet_practice">
<label>Arzt</label><input id="vet_doctor">
<label>Telefon</label><input id="vet_phone">
<label>E-Mail</label><input id="vet_email">
<label>Website</label><input id="vet_website">
</div></div>

<!-- NOTFALL -->
<div class="card"><div class="card-inner">
<h2>Notfall</h2>
<label>Klinik</label><input id="em_clinic">
<label>Adresse</label><textarea id="em_address"></textarea>
<label>Telefon</label><input id="em_phone">
<label>Hinweis</label><input id="em_note">
</div></div>

<!-- ZUHAUSE -->
<div class="card"><div class="card-inner">
<h2>Zuhause</h2>
<label>Adresse</label><textarea id="home"></textarea>
</div></div>

<!-- EXPORT -->
<div class="card actions"><div class="card-inner">
<h2>Export</h2>
<button class="download" onclick="showJSON()">üëÅÔ∏è pet.json anzeigen</button>
<button class="download" onclick="downloadJSON()">‚¨áÔ∏è pet.json herunterladen</button>
<button class="download" onclick="downloadHTML()">‚¨áÔ∏è index.html herunterladen</button>
<button class="download" onclick="downloadImage()">‚¨áÔ∏è Bild herunterladen</button>
<pre id="jsonPreview"></pre>
</div></div>

</div>
</div>

<script>
const EDITOR_PIN="4711";
let imageFile=null;

function unlock(){
  if(pin.value===EDITOR_PIN){
    lockWrapper.style.display="none";
    editor.style.display="block";
  } else alert("Falscher PIN");
}
image.onchange=e=>imageFile=e.target.files[0];

const v = id => document.getElementById(id).value.trim();

function buildPetJSON(){
  return {
    meta:{
      name:v("name"),
      pet_id:v("pet_id"),
      subtitle:v("subtitle"),
      image:imageFile?imageFile.name:"",
      last_updated:new Date().toISOString().slice(0,10)
    },
    animal:{
      species:v("species"),
      gender:v("gender"),
      birthdate:v("birthdate"),
      color:v("color"),
      breed:v("breed"),
      castrated:v("castrated"),
      outdoor:v("outdoor"),
      chipped:v("chipped"),
      vaccinated:v("vaccinated"),
      microchip:v("microchip"),
      note:v("note")
    },
    owner1:{name:v("o1_name"),phone:v("o1_phone"),email:v("o1_email")},
    owner2:{name:v("o2_name"),phone:v("o2_phone"),email:v("o2_email")},
    vet:{
      practice:v("vet_practice"),
      doctor:v("vet_doctor"),
      phone:v("vet_phone"),
      email:v("vet_email"),
      website:v("vet_website")
    },
    emergency:{
      clinic:v("em_clinic"),
      address:v("em_address"),
      phone:v("em_phone"),
      note:v("em_note")
    },
    home:{address:v("home")}
  };
}

function showJSON(){
  jsonPreview.textContent=JSON.stringify(buildPetJSON(),null,2);
  jsonPreview.style.display="block";
}

function downloadJSON(){
  const blob=new Blob([JSON.stringify(buildPetJSON(),null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob); a.download="pet.json"; a.click();
}

/* üêæ TIERSEITE */
function downloadHTML(){
  const p=buildPetJSON();
  const safe = v => v ? v : null;
  const row=(l,v)=>safe(v)?`<div class="row"><span>${l}</span><strong>${v}</strong></div>`:"";

  const html=`<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>${p.meta.name || "PET-ID"}</title>
<style>
body{margin:0;font-family:system-ui;background:#f6f6f6;color:#2b2b2b}
.container{max-width:520px;margin:20px auto;padding:16px}
.card{background:#fff;border-radius:14px;padding:20px;margin-bottom:16px;
box-shadow:0 4px 14px rgba(0,0,0,.06)}
.header{text-align:center}
.header img{width:200px;height:200px;border-radius:50%;object-fit:cover;border:4px solid #d8b48a}
.row{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #eee}
.footer{text-align:center;font-size:13px;color:#777;margin-top:24px}
.footer a{color:#777;text-decoration:none;margin:0 6px}
</style>
</head>
<body>
<div class="container">

<div class="card header">
${p.meta.image?`<img src="${p.meta.image}">`:""}
<h1>${p.meta.name || "Unbekanntes Tier"}</h1>
<div>PET-ID: ${p.meta.pet_id || "‚Äî"}</div>
${safe(p.meta.subtitle)?`<div>${p.meta.subtitle}</div>`:""}
</div>

<div class="card">
<h3>Tierdaten</h3>
${row("Tierart",p.animal.species)}
${row("Geschlecht",p.animal.gender)}
${row("Geburtsdatum",p.animal.birthdate)}
${row("Farbe",p.animal.color)}
${row("Rasse",p.animal.breed)}
${row("Kastriert",p.animal.castrated)}
${row("Freig√§nger",p.animal.outdoor)}
${row("Gechippt",p.animal.chipped)}
${row("Geimpft",p.animal.vaccinated)}
${row("Mikrochip",p.animal.microchip)}
${row("Hinweis",p.animal.note)}
</div>

<div class="footer">
<a href="/impressum.html">Impressum</a> ¬∑
<a href="/datenschutz.html">Datenschutz</a>
</div>

</div>
</body>
</html>`;

  const blob=new Blob([html],{type:"text/html"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob); a.download="index.html"; a.click();
}

function downloadImage(){
  if(!imageFile)return alert("Kein Bild ausgew√§hlt");
  const a=document.createElement("a");
  a.href=URL.createObjectURL(imageFile); a.download=imageFile.name; a.click();
}
</script>

</body>
</html>
