<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>PET-ID Editor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<meta name="theme-color" content="#d8b48a">

<link rel="shortcut icon" href="/assets/icons/favicon.ico?v=editor">
<link rel="icon" type="image/x-icon" href="/assets/icons/favicon.ico?v=editor">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32.png?v=editor">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16.png?v=editor">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-touch-icon.png?v=editor">

<style>
:root {--bg:#f6f6f6;--card:#fff;--accent:#d8b48a;--text:#2b2b2b;--muted:#777}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:var(--bg);color:var(--text)}
.lock-wrapper{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:32px}
.lock{max-width:520px;width:100%;background:var(--card);padding:32px;border-radius:18px;box-shadow:0 6px 20px rgba(0,0,0,.08);text-align:center}
.lock input{width:100%;max-width:480px;margin:0 auto 16px;padding:14px;border-radius:12px;border:1px solid #ccc;font-size:16px}
.lock button{width:100%;padding:14px;border-radius:12px;border:none;background:var(--accent);font-weight:600}
.editor{display:none;max-width:1400px;margin:0 auto;padding:32px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:32px}
@media(max-width:900px){.grid{grid-template-columns:1fr}}
.card{background:var(--card);border-radius:18px;box-shadow:0 4px 14px rgba(0,0,0,.06)}
.card-inner{padding:28px 32px}
h2{margin:0 0 12px}
label{display:block;max-width:540px;margin:18px auto 6px;font-size:14px;font-weight:600;color:#444;text-align:left}
input,textarea{width:100%;max-width:540px;margin:0 auto;display:block;padding:12px 14px;border-radius:12px;border:1px solid #ccc;font-size:15px}
textarea{min-height:70px;resize:vertical}
input[type=file]{padding:10px}
.actions{grid-column:1/-1}
.actions button{width:100%;padding:16px;border-radius:14px;border:none;font-size:16px;font-weight:600;margin-top:12px;cursor:pointer}
.download{background:#4caf50;color:#fff}
pre{background:#111;color:#0f0;padding:16px;border-radius:12px;font-size:13px;max-height:320px;overflow:auto;display:none}
</style>
</head>

<body>

<div class="lock-wrapper" id="lockWrapper">
  <div class="lock">
    <h2>üîê PET-ID Editor</h2>
    <input id="pin" placeholder="PIN">
    <button onclick="unlock()">Entsperren</button>
  </div>
</div>

<div class="editor" id="editor">
<div class="grid">

<!-- (Editor-Felder unver√§ndert ‚Äì gek√ºrzt zur √úbersicht, bleiben exakt wie bei dir) -->

<div class="card actions"><div class="card-inner">
<h2>Export</h2>
<button class="download" onclick="showJSON()">üëÅÔ∏è pet.json anzeigen</button>
<button class="download" onclick="downloadJSON()">‚¨áÔ∏è pet.json herunterladen</button>
<button class="download" onclick="downloadHTML()">‚¨áÔ∏è index.html herunterladen</button>
<button class="download" onclick="downloadImage()">‚¨áÔ∏è Bild herunterladen</button>
<pre id="jsonPreview"></pre>
</div></div>

</div>
</div>

<script>
const EDITOR_PIN="4711";
let imageFile=null;

function unlock(){
  if(pin.value===EDITOR_PIN){
    lockWrapper.style.display="none";
    editor.style.display="block";
  } else alert("Falscher PIN");
}
image.onchange=e=>imageFile=e.target.files[0];

function buildPetJSON(){
  return {
    meta:{pet_id:pet_id.value,name:name.value,subtitle:subtitle.value,image:imageFile?imageFile.name:"",last_updated:new Date().toISOString().slice(0,10)},
    animal:{species:species.value,gender:gender.value,birthdate:birthdate.value,color:color.value,breed:breed.value,castrated:castrated.value,outdoor:outdoor.value,chipped:chipped.value,vaccinated:vaccinated.value,microchip:microchip.value,note:note.value},
    owner1:{name:o1_name.value,phone:o1_phone.value,email:o1_email.value},
    owner2:{name:o2_name.value,phone:o2_phone.value,email:o2_email.value},
    vet:{practice:vet_practice.value,doctor:vet_doctor.value,phone:vet_phone.value,email:vet_email.value,website:vet_website.value},
    emergency:{clinic:em_clinic.value,address:em_address.value,phone:em_phone.value,note:em_note.value},
    home:{address:home.value}
  };
}

function showJSON(){
  const pre=document.getElementById("jsonPreview");
  pre.textContent=JSON.stringify(buildPetJSON(),null,2);
  pre.style.display="block";
}

function downloadJSON(){
  const blob=new Blob([JSON.stringify(buildPetJSON(),null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);a.download="pet.json";a.click();
}

/* üî• HTML GENERATOR */
function buildPetHTML(p){
  const row=(l,v)=>v?`<div class="row"><div class="label">${l}</div><div class="value">${v}</div></div>`:"";
  return `<!DOCTYPE html><html lang="de"><head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>${p.meta.name} ‚Äì PET-ID</title>
<style>
body{margin:0;font-family:system-ui;background:#f6f6f6;color:#2b2b2b}
.container{max-width:520px;margin:20px auto;padding:16px}
.card{background:#fff;border-radius:14px;padding:20px;margin-bottom:16px;box-shadow:0 4px 14px rgba(0,0,0,.06)}
.header{text-align:center}
.header img{width:200px;height:200px;border-radius:50%;object-fit:cover;border:4px solid #d8b48a}
.row{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #eee}
.label{color:#777}.value{font-weight:500;text-align:right}
</style></head><body><div class="container">
<div class="card header">${p.meta.image?`<img src="${p.meta.image}">`:""}<h1>${p.meta.name}</h1><div>PET-ID: ${p.meta.pet_id}</div></div>
<div class="card">${row("Tierart",p.animal.species)}${row("Geschlecht",p.animal.gender)}${row("Geburtsdatum",p.animal.birthdate)}${row("Farbe",p.animal.color)}${row("Rasse",p.animal.breed)}${row("Hinweis",p.animal.note)}</div>
</div></body></html>`;
}

function downloadHTML(){
  const blob=new Blob([buildPetHTML(buildPetJSON())],{type:"text/html"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);a.download="index.html";a.click();
}

function downloadImage(){
  if(!imageFile)return alert("Kein Bild ausgew√§hlt");
  const a=document.createElement("a");
  a.href=URL.createObjectURL(imageFile);a.download=imageFile.name;a.click();
}
</script>

</body>
</html>
